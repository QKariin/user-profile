<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Task Dom üñ§ Slave UI</title>
  <link rel="stylesheet" href="../css/profile.css">
  <link rel="stylesheet" href="../css/reward.css">
  <script type="module" src="../js/main.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@500;600;700&family=Rubik+Glitch&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
</head>
<body>

<!-- SOUND -->
<audio id="msgSound" src="https://assets.mixkit.co/active_storage/sfx/2354/2354-preview.mp3"></audio>
<audio id="coinSound" src="/audio/2019-preview1.mp3"></audio>
<audio id="skipSound" src="https://static.wixstatic.com/mp3/ce3e5b_3b5b34d4083847e2b123b6fd9a8551fd.mp3"></audio>
<audio id="sfx-buy" src="/audio/2019-preview1.mp3"></audio>
<audio id="sfx-deny" src="https://assets.mixkit.co/active_storage/sfx/2578/2578-preview.mp3"></audio>

<div id="celebrationOverlay" style="position:fixed;inset:0;pointer-events:none;z-index:9999;display:flex;align-items:center;justify-content:center;opacity:0;transition:opacity 0.3s;">
    <div class="glass-card" style="border: 2px solid var(--neon-green); text-align:center;">
        <div style="font-size:1.8rem;font-weight:900;color:var(--neon-green);text-shadow:0 0 20px var(--neon-green);">TASK<br>SUBMITTED</div>
    </div>
</div>

<svg style="display:none;">
    <symbol id="icon-coin" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1.41 16.09V20h-2.67v-1.93c-1.71-.36-3.16-1.46-3.27-3.4h1.96c.1 1.05.69 1.64 1.83 1.64 1.22 0 1.6-.64 1.6-1.26 0-.81-.42-1.22-2.34-1.67-2.37-.59-3.54-1.7-3.54-3.41 0-1.68 1.29-2.94 3.28-3.29V4h2.66v1.93c1.61.27 2.87 1.28 3.01 3.05h-1.95c-.14-.99-.68-1.55-1.7-1.55-1.04 0-1.55.56-1.55 1.15 0 .75.46 1.2 2.37 1.65 2.51.6 3.58 1.74 3.58 3.52 0 1.82-1.46 3.09-3.28 3.34z"/></symbol>
    <symbol id="icon-star" viewBox="0 0 24 24"><path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/></symbol>
    <symbol id="icon-send" viewBox="0 0 24 24"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/></symbol>
    <symbol id="icon-check" viewBox="0 0 24 24"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></symbol>
    <symbol id="icon-close" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></symbol>
    <symbol id="icon-timer" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm.5-13H11v6l5.25 3.15.75-1.23-4.5-2.67z"/></symbol>
    <symbol id="icon-gift" viewBox="0 0 24 24"><path d="M20 6h-2.18c.11-.31.18-.65.18-1a2.996 2.996 0 0 0-5.5-1.65l-.5.67-.5-.68C10.96 2.54 10.05 2 9 2 7.34 2 6 3.34 6 5c0 .35.07.69.18 1H4c-1.11 0-2 .89-2 2v4c0 1.11.89 2 2 2h1v6c0 1.11.89 2 2 2h10c1.11 0 2-.89 2-2v-6h1c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2zm-5-2c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM9 4c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1z"/></symbol>
  
  <symbol id="icon-heart" viewBox="0 0 24 24">
    <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
  </symbol>
  
  <symbol id="icon-sparkles" viewBox="0 0 24 24">
    <path d="M9.5 1L8 4.5L4.5 6L8 7.5L9.5 11L11 7.5L14.5 6L11 4.5L9.5 1zm0 0"/>
    <path d="M19 8.5L17.5 11L15 12.5L17.5 14L19 16.5L20.5 14L23 12.5L20.5 11L19 8.5zm0 0"/>
    <path d="M16.5 18L15.5 20L13.5 21L15.5 22L16.5 24L17.5 22L19.5 21L17.5 20L16.5 18zm0 0"/>
  </symbol>
  
  <symbol id="icon-crown" viewBox="0 0 24 24">
    <path d="M5 16L3 5l5.5 5L12 4l3.5 6L21 5l-2 11H5zm2.7-2h8.6l.9-5.4-2.1 1.8L12 8l-3.1 2.4-2.1-1.8L7.7 14z"/>
  </symbol>
</svg>

<input type="file" id="profileUploadInput" accept="image/*" class="hidden" onchange="handleProfileUpload(this)">

<div class="app-container">
    <div class="top-section-split">
        <!-- LEFT COLUMN: PROFILE -->
        <div class="layout-left">
            <div class="glass-card profile-card">
                <div class="pc-avatar-section">
                    <div class="pc-avatar-box" onclick="document.getElementById('profileUploadInput').click()">
                        <img id="profilePic" src="" class="pc-avatar-img">
                        <div class="pc-avatar-edit-overlay"><span style="font-size:1.5rem; color:white;">‚úé</span></div>
                    </div>
                    <div class="pc-info-wrapper">
                        <div id="subName" class="pc-name">SLAVE</div>
                        <div id="subHierarchy" class="pc-rank">LOADING...</div>
                        <div class="level-progress-container">
                            <div class="lp-labels">
                                <span>NEXT: <span id="nextLevelName">-</span></span>
                                <span id="pointsNeeded">0 to go</span>
                            </div>
                            <div class="lp-bar-bg"><div id="progressBar" class="lp-bar-fill"></div></div>
                        </div>
                        <div class="devotion-wrapper" style="margin-bottom: 20px;">
                            <div id="btn" class="kneel-btn-bar" 
                                  onmousedown="handleHoldStart(event)" 
                                  onmouseup="handleHoldEnd(event)" 
                                  onmouseleave="handleHoldEnd(event)" 
                                  ontouchstart="handleHoldStart(event)" 
                                  ontouchend="handleHoldEnd(event)"
                                 style="position: relative; display: block; cursor: pointer; user-select: none; overflow: hidden; height: 45px; background: rgba(0,0,0,0.3); border: 1px solid #333; border-radius: 20px;">
                                
                                <span id="fill" class="bar-fill" style="display: block; position: absolute; top: 0; left: 0; height: 100%; width: 0%; z-index: 1; background: linear-gradient(90deg, #8a2be2, #00f2ff); transition: none;"></span> 

                                <div class="bar-text" style="position: relative; z-index: 2; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; pointer-events: none;">
                                    <span id="txt-main" style="font-size: 0.85rem; font-weight: 900; color: white;">KNEEL</span>
                                    <span id="txt-sub" style="font-size: 0.35rem; color: #888; font-family: 'Rajdhani';">HOLD FOR 2 SECONDS</span>
                                </div>
                            </div>
                       </div>
                   </div>
                </div>
                <div class="pc-stats-grid">
                    <div class="stat-single-row row-score"><div id="points" class="ssr-val">0</div><div class="ssr-lbl">POINTS</div></div>
                    <div class="stat-single-row row-coins"><div id="coins" class="ssr-val">0</div><svg style="width:20px; height:20px; fill:var(--neon-yellow);"><use href="#icon-coin"></use></svg></div>
                </div>
                <div class="stats-toggle-btn" onclick="toggleStats()" style="color: #888 !important; text-shadow: none !important; border-color: #444 !important;">STATS ‚ñæ</div>
                <div id="statsContent">
                    <!-- NEW LOCATION: CENTERED AT TOP -->
                    <div style="text-align: center; padding: 10px 0; color: #888; text-shadow: none !important; font-size: 0.75rem; border-bottom: 1px solid #222;">
                        DAILY ID: <span id="dailyRandomId" style="color: #888; text-shadow: none !important;">#----</span>
                    </div>
                
                    <div class="stat-row-group">

                      <div class="stat-line"><span>Task Streak</span> <strong id="statStreak">0</strong></div>
                      <div class="stat-line"><span>Total Tasks</span> <strong id="statTotal">0</strong></div>
                      <div class="stat-line"><span>Completed</span> <strong id="statCompleted">0</strong></div>
                      <div class="stat-line"><span>Skipped</span> <strong id="statSkipped">0</strong></div>
                      <div class="stat-line"><span>Total Kneeling</span> <strong id="statTotalKneels">0</strong></div>
                      <div style="text-align: center; margin-top: 10px; padding-top: 10px;">
                          <div class="stat-header" style="border: none !important; text-shadow: none !important;">SLAVE SINCE</div>
                          <strong id="slaveSinceDate">--/--/--</strong>
                      </div>
                  </div>
              </div>
            </div>

            <div class="nav-tabs">
                <button class="tab-btn active" onclick="switchTab('serve')">HOME</button>
                <button class="tab-btn" onclick="switchTab('news')">QKARIN</button>
                <button class="tab-btn" onclick="switchTab('session')">BOOK SESSION</button>
                <button class="tab-btn" onclick="switchTab('rewards')">REWARDS</button>
                <button class="tab-btn" onclick="switchTab('protocol')">PROTOCOL</button>
                <button class="tab-btn btn-foot-bank" onclick="switchTab('buy')">BUY COINS</button>
            </div>
        </div>

        <!-- RIGHT COLUMN: DYNAMIC CONTENT -->
        <div class="layout-right">
            
            <!-- VIEW 1: HOME (TASKS & CHAT) -->
            <div id="viewServingTop" style="display:flex; flex-direction:column; gap:15px;">
              
                <!-- Task Card -->
                <div id="taskCard" class="glass-card">
                    <div id="activeBadge">ACTIVE TASK</div>
                    <div id="taskContent" style="width: 100%; padding: 10px 0; text-align: center;">
                        <h2 id="readyText" style="font-weight:bold; color:white; font-size:1.5rem;">Ready?</h2>
                        <p class="rajdhani" style="color:#aaa;">Waiting for orders.</p>
                    </div>
                    <div id="cooldownSection" class="hidden" style="width: 100%; text-align:center; padding-bottom: 10px;">
                        <div id="timerDisplay" style="font-size:1.5rem; font-weight:bold; margin:5px 0; color:white;">24:00:00</div>
                        <input type="file" id="evidenceInput" accept="image/*,video/*" class="hidden" onchange="handleEvidenceUpload(this)">
                        <button onclick="document.getElementById('evidenceInput').click()" class="action-btn btn-upload">UPLOAD PROOF</button>
                        <button onclick="cancelPendingTask()" id="btnSkip" style="background:transparent; border:none; color:#ddd; font-size:0.7rem; cursor:pointer;">Skip / Cancel</button>
                    </div>
                    <div id="mainButtonsArea" style="width:100%;">
                        <button id="newTaskBtn" onclick="getRandomTask()" class="action-btn" style="width: 50%; margin: 0 auto; display: block;">REQUEST TASK</button>
                    </div>
                </div>

                <!-- Chat Card (CLEAN VERSION) -->
                <div id="chatCard" class="glass-card" style="display: flex; flex-direction: column; height: 600px; padding: 0; overflow: hidden; position: relative;">
                  <div id="chatBadge">CHAT</div>
                  
                  <!-- THE REVEAL TARGET -->
                  <div id="revealSection" style="display: none;">
                      <div id="revealLevelLabel">Kneeling rewards:</div>
                      
                      <!-- THE PRIZE GRID (Opened) -->
                      <div id="revealGridContainer">
                          
                          <!-- THE INTEGRATED COMMAND BLOCK -->
                          <div class="reveal-market-row">
                              
                              <!-- TIER 1: MAIN OPTIONS -->
                              <div id="reward-main-menu" style="display: flex; flex-direction: column; gap: 8px; align-items: center;">
                                  <button onclick="toggleRewardSubMenu(true)" class="dr-enforce-btn close-btn" style="border-color:var(--neon-blue) !important; color:var(--neon-blue) !important;">
                                      OPEN MORE
                                  </button>
                                  <button onclick="toggleRewardGrid()" class="dr-enforce-btn close-btn">
                                      CLOSE VIEW
                                  </button>
                              </div>
                          
                              <!-- TIER 2: PURCHASE OPTIONS (Starts Hidden) -->
                              <div id="reward-buy-menu" class="hidden" style="flex-direction: column; gap: 6px; align-items: center;">
                                  <button onclick="buyRewardFragment(100)" class="dr-enforce-btn market-btn">
                                      1 SQUARE (100 ü™ô)
                                  </button>
                                  <button onclick="buyRewardFragment(500)" class="dr-enforce-btn market-btn" style="font-weight:900;">
                                      ENTIRE PICTURE (500 ü™ô)
                                  </button>
                                  <button onclick="toggleRewardSubMenu(false)" class="dr-enforce-btn close-btn" style="font-size:0.45rem; padding:4px 10px !important; margin-top:5px;">
                                      &larr; BACK
                                  </button>
                              </div>
              
                          </div> 
                      </div> 
                  </div> 

                <!-- CHAT HEADER -->
                <div class="chat-header-row" style="position: relative; z-index: 1001; background: rgba(15,15,15,0.9); backdrop-filter: blur(10px); padding: 12px; border-bottom: 1px solid rgba(255,255,255,0.1); flex-shrink: 0; display: flex; align-items: center; justify-content: space-between;">
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <div class="chat-avatar-container" style="position: relative; width: 50px; height: 50px;">
                            <div id="chatStatusRing" class="dom-status-ring ring-inactive"></div>
                            <img src="https://static.wixstatic.com/media/ce3e5b_1bd27ba758ce465fa89a36d70a68f355~mv2.png" style="width: 100%; border-radius: 50%;">
                        </div>
                        <div class="chat-header-info">
                            <div class="chat-header-title">QUEEN KARIN</div>
                            <div id="chatStatusBadge" class="chat-status-text">LAST SEEN: TODAY</div>
                        </div>
                    </div>
                    
                  <div id="toggleGridBtn" onclick="toggleRewardGrid()" style="cursor:pointer; opacity: 0.8; transition: 0.3s;" title="Toggle Reward View">
                      <svg style="width:22px; height:22px; fill:var(--neon-green); filter: drop-shadow(0 0 5px var(--neon-green));">
                          <use href="#icon-sparkles"></use>
                      </svg>
                  </div>
                </div>
                
                    <!-- Chat Body -->
                    <div id="chatBody" style="position: relative; flex-grow: 1; overflow: hidden; display: flex; flex-direction: column;">
                        
                        <!-- BLESSING REWARD OVERLAY -->                      
                        <div id="kneelRewardOverlay" class="hidden" style="position: absolute; inset: 0; background: rgba(0,0,0,0.92); z-index: 500; backdrop-filter: blur(20px); display: flex; align-items: center; justify-content: center;">
                            <div style="text-align: center; width: 100%; padding: 20px;">
                                <h2 style="font-family:'Orbitron'; font-weight: 900; color: white; font-size: 1.1rem; letter-spacing: 5px; margin-bottom: 30px;">RECOGNITION GRANTED</h2>
                                
                                <div class="reward-slider-container">
                                    <!-- OPTION 1: STATUS SLIDER -->
                                    <div class="iphone-slider slider-pink" onmousedown="initSlider(event, 'points')" ontouchstart="initSlider(event, 'points')">
                                        <div class="slider-fill"></div>
                                        <div class="slider-track-text">SLIDE TO RISE (+50 PTS)</div>
                                        <div class="slider-knob"><svg style="width:20px;height:20px;fill:black;"><use href="#icon-star"></use></svg></div>
                                    </div>
                        
                                    <!-- OPTION 2: WEALTH SLIDER -->
                                    <div class="iphone-slider slider-gold" onmousedown="initSlider(event, 'coins')" ontouchstart="initSlider(event, 'coins')">
                                        <div class="slider-fill"></div>
                                        <div class="slider-track-text">SLIDE TO PROFIT (+10 COINS)</div>
                                        <div class="slider-knob"><svg style="width:20px;height:20px;fill:black;"><use href="#icon-coin"></use></svg></div>
                                    </div>
                        
                                    <div style="margin: 15px 0; color: #444; font-size: 0.6rem; letter-spacing: 2px;">‚Äî OR ‚Äî</div>
                        
                                    <div style="display:flex; flex-direction:column; gap:10px; width:100%; margin-top:10px;">
                                        <button onclick="handleRevealFragment()" class="action-btn" style="background:transparent; border:1px solid var(--neon-blue); color:var(--neon-blue); font-size:0.7rem;">
                                            REVEAL GIFT
                                        </button>
                                     </div>
                                </div>
                            </div>
                        </div>

                        <div id="chatMediaOverlay" class="hidden" style="position: absolute; inset: 0; background: rgba(0,0,0,0.92); z-index: 500; backdrop-filter: blur(20px); display: flex; align-items: center; justify-content: center;">

                            <div id="mediaOverlayClose"
                                onclick="closeChatPreview()"
                                style="position:absolute; top:20px; right:20px; cursor:pointer;
                                        font-size:2rem; color:white; font-weight:300;">
                                &times;
                            </div>

                            <div id="chatMediaOverlayContent"
                                style="width: 100%; max-width: 90%; max-height: 90%;
                                        display:flex; align-items:center; justify-content:center;">
                            </div>
                        </div>
                                        
                        <div class="chat-area" id="chatBox" style="flex-grow: 1; overflow-y: auto; padding: 15px;">
                            <div id="chatContent"></div>
                        </div>
                    </div>
                
                    <!-- Chat Footer -->
                    <div class="chat-footer" style="background: transparent; flex-shrink: 0; position: relative; z-index: 1005;">
                        <div class="chat-input-row" style="padding: 10px; display: flex; gap: 10px; align-items: center; border-top: 1px solid #333;">
                            <button id="tributeHuntBtn" class="tab-btn" onclick="window.toggleTributeHunt()" style="border: 1px solid var(--neon-yellow); color: var(--neon-yellow); background: transparent; width: auto; padding: 0 15px; height: 40px; border-radius: 20px; font-family: 'Orbitron'; display: flex; align-items: center; gap: 8px; cursor: pointer;">
                                <svg style="width:16px; height:16px; fill:var(--neon-yellow);"><use href="#icon-coin"></use></svg>TRIBUTE
                            </button>
                            <input type="file" id="adminMediaInput" accept="image/*,video/*" class="hidden-input" onchange="handleAdminUpload(this)">
                            <button class="btn-plus" onclick="document.getElementById('adminMediaInput').click()" style="width: 40px; height: 40px; border-radius: 50%;">+</button>
                            <input type="text" id="chatMsgInput" class="chat-input" placeholder="Message..." onkeypress="handleChatKey(event)" style="flex-grow: 1;">
                            <button class="chat-send" onclick="sendChatMessage()"><svg style="width:20px; height:20px; fill:black;"><use href="#icon-send"></use></svg></button>
                        </div>
                    </div>

                    <!-- THE BLACKOUT TRIBUTE OVERLAY (MOVED HERE TO COVER HEADER AND FOOTER) -->
                    <div id="tributeHuntOverlay" class="hidden" style="position: absolute; inset: 0; background: rgba(0,0,0,0.98); z-index: 5000; backdrop-filter: blur(20px); display: flex; flex-direction: column; overflow: hidden;">
                    <div class="tribute-moment-header" style="display: flex; justify-content: space-between; align-items: center; padding: 15px 20px; border-bottom: 1px solid #111; flex-shrink:0;">
                        <div id="huntProgress" style="font-family:'Orbitron'; font-size:0.7rem; color:var(--neon-yellow); letter-spacing:3px;">INTENTION</div>
                        <div onclick="toggleTributeHunt()" style="color:#444; cursor:pointer; font-size:1.8rem;">&times;</div>
                    </div>
                
                    <div class="tribute-moment-body" style="flex: 1; display: flex; align-items: center; justify-content: center; padding: 10px; position: relative; overflow: hidden;">
                        <!-- STEP 1 -->
                        <div id="huntStep1" class="hunt-step">
                            <div style="display: flex; flex-direction: column; gap: 12px; width: 220px;">
                                <button class="tab-btn" onclick="selectTributeReason('Love & Adoration')">LOVE & ADORATION</button>
                                <button class="tab-btn" onclick="selectTributeReason('Seeking Forgiveness')">FORGIVENESS</button>
                                <button class="tab-btn" onclick="selectTributeReason('Pure Devotion')">PURE DEVOTION</button>
                            </div>
                        </div>
                
                        <!-- STEP 3: THE HUNT -->
                        <div id="huntStep3" class="hunt-step hidden" style="width: 100%; height: 100%; display: flex; align-items: center; justify-content: center;">
                            <div id="huntStoreGrid"></div>
                        </div>
                
                        <!-- STEP 4: CONFESSION (FINAL CARD) -->
                        <div id="huntStep4" class="hunt-step hidden" style="width: 90%; text-align: center;">
                            <div id="huntSummary" style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 12px; border: 1px solid #222; margin-bottom: 15px;">
                                <img id="huntSelectedImg" src="" style="max-height: 80px; margin-bottom: 10px; object-fit: contain;">
                                <div id="huntSelectedName" style="font-size: 0.7rem; font-weight: bold; color: white;">ITEM NAME</div>
                                <div id="huntSelectedPrice" style="font-size: 0.9rem; color: var(--neon-yellow);">0 ü™ô</div>
                            </div>
                            
                            <textarea id="huntNote" placeholder="Write your words..." maxlength="200" style="width: 100%; height: 80px; background: rgba(0,0,0,0.5); border: 1px solid var(--neon-pink); border-radius: 10px; color: white; padding: 10px; font-family: 'Rajdhani'; resize: none; outline: none; margin-bottom: 15px;"></textarea>
                            
                            <button class="action-btn" onclick="finalizeSacrifice()" style="background: var(--neon-pink); color: black; font-weight: 900; margin-bottom: 10px;">SUBMIT SACRIFICE</button>
                            
                            <div style="display: flex; gap: 10px;">
                                <button class="tab-btn" onclick="showHuntStep(3)" style="font-size: 0.6rem; border-color: #444;">GO BACK</button>
                                <button class="tab-btn" onclick="toggleTributeHunt()" style="font-size: 0.6rem; border-color: var(--neon-red); color: var(--neon-red);">CLOSE</button>
                            </div>
                        </div>
                    </div>
               </div>
            <!-- VIEW 7: QKARIN (NEW SOCIAL PROFILE) -->
            <div id="viewNews" class="hidden">
                <div class="glass-card" style="height: 100%; padding:0; overflow:hidden; background:#000;">
                    
                    <div class="social-header">
                        <div class="sh-avatar-frame">
                            <img src="https://static.wixstatic.com/media/ce3e5b_1bd27ba758ce465fa89a36d70a68f355~mv2.png" class="sh-avatar">
                        </div>
                        <div class="sh-info">
                            <div class="sh-name">QUEEN KARIN</div>
                            <div class="sh-bio">Time to serve.</div>
                            <div class="sh-stats">
                                <div class="sh-stat-item"><span class="sh-val" id="cntPosts">0</span><span class="sh-lbl">POSTS</span></div>
                                <div class="sh-stat-item"><span class="sh-val">‚àû</span><span class="sh-lbl">OWNER</span></div>
                                <div id="domStatusBadge" class="sh-stat-item"><span class="sh-val" style="color:var(--neon-green)">ONLINE</span><span class="sh-lbl">STATUS</span></div>
                            </div>
                        </div>
                    </div>

                    <div id="domVideoReel" class="highlights-rail"></div>

                    <div class="feed-nav"><div class="fn-btn active">GRID</div></div>

                    <div id="newsGrid" class="social-grid"></div>

                    <div id="streamContainer" class="video-container hidden" style="margin-top:20px;">
                        <iframe id="twitchFrame" class="twitch-iframe" src="" allowfullscreen></iframe>
                        <div id="streamLockOverlay" class="glass-lock-overlay">...</div>
                    </div>

                </div>
            </div>

            <!-- STANDALONE TRIBUTE VIEW -->
            <div id="viewTribute" class="hidden">
              <div class="glass-card" style="min-height: 450px; display: flex; flex-direction: column; padding: 25px;">
                  <h2 id="tributeHeading" style="text-align:center; color:white; font-family:'Rubik Glitch'; font-size:1.8rem; margin-bottom:20px; letter-spacing: 3px;">THE OFFERING</h2>
          
                  <div id="tributeStep1" class="tribute-step">
                      <p style="text-align:center; color:#888; font-family:'Rajdhani'; margin-bottom:20px; text-transform: uppercase; letter-spacing: 1px;">Step 1: State your intent</p>
                      <div class="nav-tabs" style="width:100% !important; gap: 10px;">
                          <button class="tab-btn" onclick="selectTributeReason('Love & Adoration')">LOVE & ADORATION</button>
                          <button class="tab-btn" onclick="selectTributeReason('Seeking Forgiveness')">SEEKING FORGIVENESS</button>
                          <button class="tab-btn" onclick="selectTributeReason('Begging for Mercy')">BEGGING FOR MERCY</button>
                          <button class="tab-btn" onclick="selectTributeReason('Pure Devotion')">PURE DEVOTION</button>
                          <button class="tab-btn" onclick="selectTributeReason('Special Request')">SPECIAL REQUEST</button>
                      </div>
                  </div>
          
                  <div id="tributeStep2" class="tribute-step hidden">
                      <p style="text-align:center; color:#888; font-family:'Rajdhani'; margin-bottom:20px; text-transform: uppercase;">Step 2: Your words to Queen Karin</p>
                      <textarea id="tributeNote" placeholder="Write your confession or worship here..." style="width:100%; background:rgba(0,0,0,0.6); border:1px solid var(--neon-pink); border-radius:12px; color:white; padding:15px; font-family:'Rajdhani'; min-height:120px; outline:none; margin-bottom:15px; font-size: 1rem; box-shadow: inset 0 0 10px rgba(0,0,0,0.5);"></textarea>
                      <button class="action-btn" onclick="setTributeNote()" style="background: var(--neon-pink); color: black;">CONTINUE</button>
                      <button onclick="showTributeStep(1)" style="background:transparent; border:none; color:#555; margin-top:10px; width:100%; cursor:pointer; font-size: 0.7rem;">BACK</button>
                  </div>
          
                  <div id="tributeStep3" class="tribute-step hidden">
                      <p style="text-align:center; color:#888; font-family:'Rajdhani'; margin-bottom:20px; text-transform: uppercase;">Step 3: Sacrifice Amount</p>
                      <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
                          <button class="tab-btn" onclick="filterByBudget(1000)">1,000 ü™ô</button>
                          <button class="tab-btn" onclick="filterByBudget(3000)">3,000 ü™ô</button>
                          <button class="tab-btn" onclick="filterByBudget(5000)">5,000 ü™ô</button>
                          <button class="tab-btn" onclick="filterByBudget(10000)">10,000 ü™ô</button>
                          <button class="tab-btn" onclick="filterByBudget(999999)" style="grid-column: span 2; border-color: var(--neon-yellow); color: var(--neon-yellow);">UNLIMITED</button>
                      </div>
                      <button onclick="showTributeStep(2)" style="background:transparent; border:none; color:#555; margin-top:20px; width:100%; cursor:pointer; font-size: 0.7rem;">BACK</button>
                  </div>
          
                  <div id="tributeStep4" class="tribute-step hidden">
                      <p style="text-align:center; color:#888; font-family:'Rajdhani'; margin-bottom:15px; text-transform: uppercase;">Step 4: Select Gift</p>
                      <div id="storeGrid" class="store-grid"></div>
                      <button onclick="resetTributeFlow()" style="background:transparent; border:none; color:#555; margin-top:20px; width:100%; cursor:pointer; font-size: 0.7rem; letter-spacing: 2px;">CANCEL / RESTART</button>
                  </div>
              </div>
          </div>

            <!-- THE VAULT -->
            <div id="viewVault" class="hidden">
                <div class="glass-card">
                    <h2 style="text-align:center; color:white; font-family:'Orbitron'; font-size:1.5rem; margin-bottom:20px; letter-spacing:3px;">THE QUEEN'S VAULT</h2>
                    <p style="text-align:center; color:#666; font-family:'Rajdhani'; font-size:0.8rem; margin-bottom:20px;">YOUR PERMANENT COLLECTION OF UNLOCKED DIRECTIVES.</p>
                    
                    <div id="vaultGrid" class="gallery-grid">
                    </div>
                </div>
            </div>
                        
            <div id="viewSession" class="hidden">
                <div class="glass-card" style="text-align:center; padding: 50px;">
                    <h2 style="font-size:2rem; color:var(--neon-pink); text-shadow:0 0 10px var(--neon-pink);">PRIVATE SESSIONS</h2>
                    <p style="color:#aaa; font-family:'Rajdhani'; margin-top:10px;">Currently offline. Check back later.</p>
                    <button class="action-btn" style="margin-top:20px; opacity:0.5; cursor:not-allowed;">CHECK AVAILABILITY</button>
                </div>
            </div>
            
            <div id="viewProtocol" class="hidden">
                <div class="glass-card">
                    <h2 style="text-align:center; color:white; font-family:'Orbitron'; font-size:1.8rem; margin-bottom:20px; letter-spacing:2px;">OPERATIONAL PROTOCOL</h2>

                    <div style="display:grid; grid-template-columns: 1fr; gap:10px;">

                        <div class="protocol-item" onclick="toggleSection(this)" style="border:1px solid var(--neon-yellow);">
                            <h3 class="protocol-header" style="color:var(--neon-yellow);">
                                <div style="display:flex; align-items:center; gap:10px;">
                                    <svg style="width:18px; height:18px; fill:var(--neon-yellow);"><use href="#icon-coin"></use></svg> 
                                    THE ECONOMY
                                </div>
                                <span class="protocol-arrow">‚ñº</span>
                            </h3>
                            <div class="protocol-content">
                                <p style="margin-bottom:10px;"><strong style="color:white;">COINS (Currency):</strong> Your physical worth. Used to buy gifts from the <strong>Wishlist</strong>, pay mandatory tributes, or purchase your freedom from a task via the <strong>Skip</strong> function.</p>
                                <p><strong style="color:white;">POINTS (Status):</strong> Your spiritual worth. Earned strictly through <strong>Kneeling</strong> and completing <strong>Duties</strong>. Points determine your rank in the <strong>Hierarchy</strong>.</p>
                            </div>
                        </div>

                        <div class="protocol-item" onclick="toggleSection(this)" style="border:1px solid var(--neon-green);">
                            <h3 class="protocol-header" style="color:var(--neon-green);">
                                <div style="display:flex; align-items:center; gap:10px;">
                                    <svg style="width:18px; height:18px; fill:var(--neon-green);"><path d="M7 2v11h3v9l7-12h-4l4-8z"/></svg> 
                                    DUTY & TASKS
                                </div>
                                <span class="protocol-arrow">‚ñº</span>
                            </h3>
                            <div class="protocol-content">
                                <p style="margin-bottom:10px;">Click <strong>"REQUEST TASK"</strong> to receive your orders.</p>
                                <ul style="list-style: none; padding-left: 0; color: #ccc;">
                                    <li style="margin-bottom:5px;"><strong style="color:white;">- 24h Deadline:</strong> Proof must be uploaded within 24 hours.</li>
                                    <li><strong style="color:white;">- Failure:</strong> A <strong>300 COIN FINE</strong> is applied automatically if the timer expires.</li>
                                </ul>
                            </div>
                        </div>

                        <div class="protocol-item" onclick="toggleSection(this)" style="border:1px solid var(--neon-pink);">
                            <h3 class="protocol-header" style="color:var(--neon-pink);">
                                <div style="display:flex; align-items:center; gap:10px;">
                                    <svg style="width:18px; height:18px; fill:var(--neon-pink);"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg> 
                                    DEVOTION
                                </div>
                                <span class="protocol-arrow">‚ñº</span>
                            </h3>
                            <div class="protocol-content">
                                <p>Kneel once every <strong>1 minute</strong> via the profile bar. Consistency prevents rank degradation.</p>
                            </div>
                        </div>

                        <div class="protocol-item" onclick="toggleSection(this)" style="border:1px solid #fff;">
                            <h3 class="protocol-header" style="color:#fff;">
                                <div style="display:flex; align-items:center; gap:10px;">
                                    <svg style="width:18px; height:18px; fill:#fff;"><path d="M12 2l2.4 4.9 5.4.8-3.9 3.8.9 5.4-4.8-2.5-4.8 2.5.9-5.4-3.9-3.8 5.4-.8z"/></svg> 
                                    ROYAL HIERARCHY
                                </div>
                                <span class="protocol-arrow">‚ñº</span>
                            </h3>
                            <div class="protocol-content">
                                <p style="margin-bottom:15px; font-size:0.8rem; color:#aaa;">Ranks are earned through total Points. Higher ranks unlock private session slots.</p>
                                <div id="hierarchyGrid" class="grid gap-4"></div>
                            </div>
                        </div>

                        <div class="protocol-item" onclick="toggleSection(this)" style="border:1px solid #ff003c;">
                            <h3 class="protocol-header" style="color:#ff003c;">
                                <div style="display:flex; align-items:center; gap:10px;">
                                    <svg style="width:18px; height:18px; fill:#ff003c;"><path d="M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"/></svg> 
                                    COMMANDS
                                </div>
                                <span class="protocol-arrow">‚ñº</span>
                            </h3>
                            <div class="protocol-content">
                                <p><strong style="color:white;">Glass Break:</strong> Click the broken glass overlay immediately to read urgent commands.</p>
                            </div>
                        </div>

                        <div class="protocol-item" onclick="toggleSection(this)" style="border:1px solid #666;">
                            <h3 class="protocol-header" style="color:#ccc;">
                                <div style="display:flex; align-items:center; gap:10px;">
                                    <svg style="width:18px; height:18px; fill:#ccc;"><path d="M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"/></svg> 
                                    LAWS & REGULATIONS
                                </div>
                                <span class="protocol-arrow">‚ñº</span>
                            </h3>
                            <div class="protocol-content">
                                <ul style="list-style: none; padding: 0; margin: 0; color: #ccc;">
                                    <li style="margin-bottom: 8px;"><strong style="color:white;">Section 1:</strong> <span id="r1">Loading...</span></li>
                                    <li style="margin-bottom: 8px;"><strong style="color:white;">Section 2:</strong> <span id="r2">Loading...</span></li>
                                    <li style="margin-bottom: 8px;"><strong style="color:white;">Section 3:</strong> <span id="r3">Loading...</span></li>
                                    <li style="margin-bottom: 8px;"><strong style="color:white;">Section 4:</strong> <span id="r4">Loading...</span></li>
                                    <li style="margin-bottom: 8px;"><strong style="color:white;">Section 5:</strong> <span id="r5">Loading...</span></li>
                                    <li style="margin-bottom: 8px;"><strong style="color:white;">Section 6:</strong> <span id="r6">Loading...</span></li>
                                    <li style="margin-bottom: 8px;"><strong style="color:white;">Section 7:</strong> <span id="r7">Loading...</span></li>
                                    <li style="margin-bottom: 0px;"><strong style="color:white;">Section 8:</strong> <span id="r8">Loading...</span></li>
                                </ul>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
            <div id="viewRewards" class="hidden">
                <div class="glass-card" style="text-align:center; padding: 50px;">
                    <h2 style="font-size:2rem; color:var(--neon-yellow); text-shadow:0 0 10px var(--neon-yellow);">REWARDS</h2>
                    <p style="color:#aaa; font-family:'Rajdhani'; margin-top:10px;">Unlock perks as you level up.</p>
                    <div style="margin-top:20px; font-size: 3rem;">üéÅ</div>
                </div>
            </div>

            <div id="viewHierarchy" class="hidden">
                <div class="glass-card">
                    <div class="text-center mb-4"><h1 class="accent text-2xl md:text-4xl font-bold mb-1">ROYAL HIERARCHY</h1><p class="text-gray-400 text-xs">Slave devotion ranks</p></div>
                    <div class="grid gap-4" id="hierarchyGrid"></div>
                </div>
            </div>

            <div id="viewBuy" class="hidden">
                <div class="glass-card">
                    <h2 style="text-align:center; color:var(--neon-yellow); font-family:'Rubik Glitch', sans-serif; font-size:2rem; margin-bottom:5px; text-shadow:0 0 10px rgba(255,215,0,0.3);">BUY COINS</h2>
                    <p style="text-align:center; color:#888; font-family:'Rajdhani'; font-size:0.8rem; margin-bottom:15px;">Purchase coins to pay tribute.</p>
                    <div class="store-grid">
                        <div class="store-item" style="border-color: var(--neon-yellow);"><div class="si-img-box"><svg style="width:40px; height:40px; fill:var(--neon-yellow);"><use href="#icon-coin"></use></svg></div><div class="si-info"><div class="si-name" style="color:white;">1.000 COINS</div><button class="si-btn" style="background:rgba(255,215,0,0.1); border-color:var(--neon-yellow); color:var(--neon-yellow);" onclick="buyRealCoins(1000)">‚Ç¨10.00</button></div></div>
                        <div class="store-item" style="border-color: var(--neon-yellow);"><div class="si-img-box"><svg style="width:50px; height:50px; fill:var(--neon-yellow);"><use href="#icon-coin"></use></svg></div><div class="si-info"><div class="si-name" style="color:white;">5.500 COINS</div><button class="si-btn" style="background:rgba(255,215,0,0.1); border-color:var(--neon-yellow); color:var(--neon-yellow);" onclick="buyRealCoins(5500)">‚Ç¨50.00</button></div></div>
                        <div class="store-item" style="border-color: var(--neon-yellow); box-shadow: 0 0 10px rgba(255,215,0,0.2);"><div class="si-img-box"><div style="position:absolute; font-size:2rem;">üí∞</div></div><div class="si-info"><div class="si-name" style="color:white;">12.000 COINS</div><button class="si-btn" style="background:var(--neon-yellow); border-color:var(--neon-yellow); color:black; font-weight:bold;" onclick="buyRealCoins(12000)">‚Ç¨100.00</button></div></div>
                        <div class="store-item" style="border-color: var(--neon-yellow);"><div class="si-img-box"><div style="position:absolute; font-size:2rem;">üíé</div></div><div class="si-info"><div class="si-name" style="color:white;">30.000 COINS</div><button class="si-btn" style="background:rgba(255,215,0,0.1); border-color:var(--neon-yellow); color:var(--neon-yellow);" onclick="buyRealCoins(30000)">‚Ç¨250.00</button></div></div>
                        <div class="store-item" style="border-color: var(--neon-yellow);"><div class="si-img-box"><div style="position:absolute; font-size:2rem;">üëë</div></div><div class="si-info"><div class="si-name" style="color:white;">70.000 COINS</div><button class="si-btn" style="background:rgba(255,215,0,0.1); border-color:var(--neon-yellow); color:var(--neon-yellow);" onclick="buyRealCoins(70000)">‚Ç¨500.00</button></div></div>
                        <div class="store-item" style="border-color: var(--neon-yellow);"><div class="si-img-box"><div style="position:absolute; font-size:2rem;">üè¶</div></div><div class="si-info"><div class="si-name" style="color:white;">150.000 COINS</div><button class="si-btn" style="background:rgba(255,215,0,0.1); border-color:var(--neon-yellow); color:var(--neon-yellow);" onclick="buyRealCoins(150000)">‚Ç¨1000.00</button></div></div>
                    </div>
                </div>
            </div>
            </div> <!-- End viewServingTop -->

        </div>
    </div> <!-- END top-section-split -->

    <!-- EVIDENCE LOG (FULL WIDTH) -->
    <div style="display:flex; align-items:center; gap:8px; margin-bottom:10px; font-size:0.8rem; color:#fff; font-weight:bold; padding-left: 5px;">
        <div style="width:6px; height:6px; background:var(--neon-yellow); border-radius:50%;"></div> EVIDENCE LOG
    </div>

    <div id="pendingSection" style="display:none; width:100%;">
        <div class="section-header">PENDING REVIEW</div>
        <div id="pendingGrid" class="pending-grid"></div>
    </div>

    <!-- THE HISTORY SECTION -->
    <div id="historySection" style="display:none; position: relative; min-height: 450px;">
        <div class="section-header">EVIDENCE LOG / HISTORY</div>
    
        <!-- THE JAILED THEATER MODAL -->
        <div id="glassModal" class="glass-modal" onclick="closeModal(event)">
            <div id="modalMediaContainer" class="modal-bg-photo"></div>
            
            <div id="modalGlassOverlay" class="modal-glass-overlay">
                <div id="modalCloseX" onclick="closeModal(null)">√ó</div>
        
                <!-- MAIN CONTENT AREA -->
                <div class="theater-content">
                    <div id="modalInfoView" class="sub-view">
                        <div class="stamp-container">
                            <img id="modalStatusSticker" src="" class="m-status-sticker-lg">
                        </div>
                        <div class="reward-container">
                            <div id="modalPoints" class="m-points-lg">+0 PTS</div>
                            <div id="modalSticker"></div>
                        </div>
                    </div>
        
                    <div id="modalFeedbackView" class="sub-view hidden">
                        <h3 class="view-label">QUEEN'S FEEDBACK</h3>
                        <div id="modalFeedbackMedia" class="fb-media-theater"></div>
                        <div id="modalFeedbackText" class="theater-text-box"></div>
                    </div>
        
                    <div id="modalTaskView" class="sub-view hidden">
                        <h3 class="view-label">THE ASSIGNMENT</h3>
                        <div id="modalOrderText" class="theater-text-box"></div>
                    </div>
                </div>
        
                <!-- BOTTOM ACTIONS -->
                <div class="modal-footer-menu">
                    <button onclick="toggleHistoryView('feedback')" class="history-action-btn">FEEDBACK</button>
                    <button onclick="toggleHistoryView('task')" class="history-action-btn">THE TASK</button>
                    <button onclick="event.stopPropagation(); toggleHistoryView('proof')" class="history-action-btn">SEE PROOF</button>
                    <button onclick="toggleHistoryView('info')" class="history-action-btn">STATUS</button>
                    <button onclick="closeModal(null)" class="history-action-btn btn-close-red" style="grid-column: span 2;">CLOSE</button>
                </div>
            </div>
        </div>
    
        <!-- THE ACTUAL HISTORY GRID -->
        <div id="historyGrid" class="gallery-grid"></div>
        <button id="loadMoreBtn" onclick="loadMoreHistory()" class="action-btn" style="display:none; margin-top:20px;">LOAD MORE...</button>
    </div>
</div> <!-- END app-container -->
          
</body>
</html>
